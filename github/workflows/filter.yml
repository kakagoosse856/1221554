name: Filter Channels

on:
  workflow_dispatch:
  schedule:
    - cron: "*/30 * * * *"  # ÙƒÙ„ 30 Ø¯Ù‚ÙŠÙ‚Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)

permissions:
  contents: write   # Ø¶Ø±ÙˆØ±ÙŠ Ø¬Ø¯Ù‹Ø§ Ù„Ù„ÙƒØªØ§Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹

jobs:
  filter:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          persist-credentials: true  # ğŸ”¥ ÙŠØ³Ù…Ø­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… PAT ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.x"

      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install requests

      - name: Run filter script
        run: python filter.py

      - name: Commit & push changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          # Ø¬Ù„Ø¨ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø© Ù…Ù† main
          git fetch origin main
          git checkout main
          git reset --hard origin/main  # ÙŠØ¬Ø¹Ù„ Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ù…Ø­Ù„ÙŠ Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„Ù€ main Ø¹Ù„Ù‰ GitHub

          # Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ù…Ù„ÙØ§Øª m3u Ø¬Ø¯ÙŠØ¯Ø©
          git add *.m3u

          # Ø¥Ù†Ø´Ø§Ø¡ commit ÙÙ‚Ø· Ø¥Ø°Ø§ Ù‡Ù†Ø§Ùƒ ØªØºÙŠÙŠØ±Ø§Øª
          git diff --cached --quiet || git commit -m "Update alive channels"

          # Ø±ÙØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù„Ù‰ main Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… PAT
          git push https://$PAT_TOKEN@github.com/kakagoosse856/1221554 main --force
        env:
          PAT_TOKEN: ${{ secrets.PAT_TOKEN }}
